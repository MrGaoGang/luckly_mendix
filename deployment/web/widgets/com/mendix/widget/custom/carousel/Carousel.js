!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("react-dom"),require("react"));else if("function"==typeof define&&define.amd)define(["react-dom","react"],e);else{var r="object"==typeof exports?e(require("react-dom"),require("react")):e(t["react-dom"],t.react);for(var o in r)("object"==typeof exports?exports:t)[o]=r[o]}}("undefined"!=typeof self?self:this,function(t,e){return function(t){function e(o){if(r[o])return r[o].exports;var i=r[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,o){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=3)}([function(t,r){t.exports=e},function(t,e,r){var o,i;/*!
  Copyright (c) 2016 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
!function(){"use strict";function r(){for(var t=[],e=0;e<arguments.length;e++){var o=arguments[e];if(o){var i=typeof o;if("string"===i||"number"===i)t.push(o);else if(Array.isArray(o))t.push(r.apply(null,o));else if("object"===i)for(var s in o)n.call(o,s)&&o[s]&&t.push(s)}}return t.join(" ")}var n={}.hasOwnProperty;void 0!==t&&t.exports?t.exports=r:(o=[],void 0!==(i=function(){return r}.apply(e,o))&&(t.exports=i))}()},function(t,e,r){var o,i;o=[r,e,r(0),r(1)],void 0!==(i=function(t,e,r,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Alert=function(t){var e=t.className,i=t.bootstrapStyle,n=t.message;return n?r.createElement("div",{className:o("alert alert-"+i,e)},n):null},e.Alert.displayName="Alert"}.apply(e,o))&&(t.exports=i)},function(t,e,r){var o,i,n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();o=[r,e,r(0),r(4),r(5),r(2),r(9)],void 0!==(i=function(t,e,r,o,i,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(t){function e(r){var o=t.call(this,r)||this,i=e.validateProps(r);return o.state={alertMessage:i,images:[],isLoading:!0,showAlert:!!i},o.executeAction=o.executeAction.bind(o),o.subscriptionCallback=function(t){return function(){return o.fetchData(t)}},o.onParseStyleError=o.onParseStyleError.bind(o),o.getUrl=o.getUrl.bind(o),o}return n(e,t),e.prototype.render=function(){return this.state.showAlert?r.createElement(s.Alert,{bootstrapStyle:"danger",className:"widget-carousel-alert",message:this.state.alertMessage}):this.state.isLoading?r.createElement("div",{},r.createElement("i",{className:"glyphicon glyphicon-cog glyph-spin"}),r.createElement("span",{}," Loading ...")):r.createElement(i.Carousel,{alertMessage:this.state.alertMessage,className:this.props.class,images:this.state.images,onClickAction:this.executeAction,style:e.parseStyle(this.props.style,this.onParseStyleError)})},e.prototype.componentWillReceiveProps=function(t){if(!this.widgetId){var e=o.findDOMNode(this);this.widgetId=e.getAttribute("widgetId")||void 0}this.resetSubscription(t.mxObject),this.setState({isLoading:!0}),this.fetchData(t.mxObject)},e.prototype.componentDidUpdate=function(){if(this.widgetId){o.findDOMNode(this).setAttribute("widgetId",this.widgetId)}},e.prototype.componentWillUnmount=function(){this.subscriptionHandle&&window.mx.data.unsubscribe(this.subscriptionHandle)},e.validateProps=function(t){var e="";return"static"!==t.dataSource||t.staticImages.length||(e="For the data source option 'Static', at least one static image should be added"),"XPath"!==t.dataSource||t.imagesEntity||(e="For the data source 'XPath', the images entity is required"),"microflow"!==t.dataSource||t.dataSourceMicroflow||(e="For data source option 'microflow', a data source microflow is required"),e},e.prototype.resetSubscription=function(t){this.subscriptionHandle&&window.mx.data.unsubscribe(this.subscriptionHandle),t&&(this.subscriptionHandle=window.mx.data.subscribe({callback:this.subscriptionCallback(t),guid:t.getGuid()}))},e.prototype.fetchData=function(t){if("static"===this.props.dataSource){var e=this.props.staticImages.map(function(t){return t.url=a.UrlHelper.getStaticResourceUrl(t.url),t});this.setState({images:e,isLoading:!1})}else"XPath"===this.props.dataSource&&this.props.imagesEntity&&t?this.fetchImagesByXPath(t):"microflow"===this.props.dataSource&&this.props.dataSourceMicroflow&&this.fetchImagesByMicroflow(this.props.dataSourceMicroflow,t)},e.prototype.fetchImagesByXPath=function(t){var e=this,r=this.props.entityConstraint,o=r&&r.indexOf("[%CurrentObject%]")>-1,i=t.getGuid();if(!i&&o)return void this.setState({images:[],isLoading:!1});var n=r?r.replace(/\[%CurrentObject%\]/g,i):"";window.mx.data.get({callback:function(t){return e.setImagesFromMxObjects(t)},error:function(t){return e.setState({alertMessage:"An error occurred while retrieving items via XPath ("+r+"): "+t,images:[]})},xpath:"//"+this.props.imagesEntity+n})},e.prototype.fetchImagesByMicroflow=function(t,e){var r=this;t&&window.mx.ui.action(t,{callback:function(t){return r.setImagesFromMxObjects(t)},error:function(e){return r.setState({alertMessage:"An error occurred while retrieving images via the microflow "+t+":\n                            "+e.message,images:[]})},params:{applyto:"selection",guids:e?[e.getGuid()]:[]}})},e.prototype.setImagesFromMxObjects=function(t){var e=this;t=t||[];var r=t.map(function(t){return new Promise(function(r,o){if(e.props.urlAttribute)r(e.getImageProps(t,t.get(e.props.urlAttribute)));else{var i=mx.data.getDocumentUrl(t.getGuid(),t.get("changedDate"));mx.data.getImageUrl(i,function(o){r(e.getImageProps(t,o))},function(t){o("Error in carousel while retrieving image url: "+t.message)})}})});Promise.all(r).then(function(t){e.setState({images:t,isLoading:!1})})},e.prototype.getImageProps=function(t,e){var r=this.props,o=r.onClickOptions,i=r.onClickForm,n=r.onClickMicroflow,s=r.onClickNanoflow,a=r.openPageAs;return{guid:t.getGuid(),onClickForm:"showPage"===o?i:void 0,onClickMicroflow:"callMicroflow"===o?n:void 0,onClickNanoflow:"callNanoflow"===o?s:void 0,openPageAs:a,url:e}},e.prototype.getUrl=function(t){var e=this;return mx.data.getImageUrl(t,function(t){e.xpathUrl=t},function(t){return e.setState({alertMessage:"Error in imageviewer while retrieving image url: "+t.message})}),this.xpathUrl},e.prototype.executeAction=function(t){var e=this.getContext(t);t.onClickMicroflow?window.mx.ui.action(t.onClickMicroflow,{context:e,origin:this.props.mxform,error:function(e){return window.mx.ui.error("An error occurred while executing action "+t.onClickMicroflow+" : "+e.message)}}):t.onClickNanoflow&&t.onClickNanoflow.nanoflow?window.mx.data.callNanoflow({nanoflow:t.onClickNanoflow,context:e,origin:this.props.mxform,error:function(t){return mx.ui.error("An error occurred while executing the on click nanoflow: "+t.message)}}):t.onClickForm&&window.mx.ui.openForm(t.onClickForm,{location:t.openPageAs,context:e,error:function(e){return window.mx.ui.error("An error occurred while opening form "+t.onClickForm+" : "+e.message)}})},e.prototype.getContext=function(t){var e=new window.mendix.lib.MxContext;return t.guid?e.setContext(this.props.imagesEntity,t.guid):this.props.mxObject&&e.setContext(this.props.mxObject.getEntity(),this.props.mxObject.getGuid()),e},e.parseStyle=function(t,e){void 0===t&&(t="");try{return t.split(";").reduce(function(t,e){var r=e.split(":");if(2===r.length){t[r[0].trim().replace(/(-.)/g,function(t){return t[1].toUpperCase()})]=r[1].trim()}return t},{})}catch(r){e("Failed to parse style "+t+": "+r)}return{}},e.prototype.onParseStyleError=function(t){this.setState({alertMessage:t})},e}(r.Component);e.default=c}.apply(e,o))&&(t.exports=i)},function(e,r){e.exports=t},function(t,e,r){var o,i,n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();o=[r,e,r(0),r(1),r(2),r(6),r(7),r(8)],void 0!==(i=function(t,e,r,o,i,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(t){function e(e){var r=t.call(this,e)||this;return r.carouselWidth=0,r.carouselItems=[],r.state={activeIndex:0,alertMessage:e.alertMessage,animate:!1,position:0,showControls:r.props.images.length>1},r.moveToTheLeft=function(){return r.moveInDirection("left")},r.moveToTheRight=function(){return r.moveInDirection("right")},r.handleSwipe=r.handleSwipe.bind(r),r.addCarouselItem=r.addCarouselItem.bind(r),r.handleSwipeLeftEnd=function(t){return r.handleSwipeEnd(t,"left")},r.handleSwipeRightEnd=function(t){return r.handleSwipeEnd(t,"right")},r.onClickAction=function(t){return function(){e.onClickAction&&e.onClickAction(t)}},r}return n(e,t),e.prototype.render=function(){var t=this.props,e=t.className,n=t.images,s=t.style;return r.createElement("div",{className:o("widget-carousel-wrapper",e),style:s},r.createElement(i.Alert,{bootstrapStyle:"danger",className:"widget-carousel-alert",message:this.state.alertMessage}),r.createElement("div",{className:"widget-carousel"},r.createElement("div",{className:o("widget-carousel-item-wrapper",{animate:this.state.animate}),style:{transform:"translate3d("+this.state.position+"%, 0px, 0px)"}},this.createCarouselItems(n,this.state.activeIndex||0)),this.createCarouselControls()))},e.prototype.componentWillReceiveProps=function(t){this.carouselItems.length&&(this.removeEvents(),this.carouselItems=[]),this.setState({alertMessage:t.alertMessage,showControls:t.images.length>1})},e.prototype.componentWillUnmount=function(){this.removeEvents()},e.prototype.createCarouselItems=function(t,e){var o=this;return t.map(function(t,i){var n=o.getItemStatus(i,e),s=n.position,c=n.status;return r.createElement(a.CarouselItem,{getItemNode:o.addCarouselItem,key:i,onClick:o.onClickAction(t),position:s,status:c,url:t.url})})},e.prototype.getItemStatus=function(t,e){return{position:100*(t-e),status:o({active:t===e,next:e<t,prev:e>t})}},e.prototype.createCarouselControls=function(){var t=this;return this.state.showControls?(this.state.activeIndex===this.props.images.length-1?["left"]:0===this.state.activeIndex?["right"]:["right","left"]).map(function(e,o){return r.createElement(s.CarouselControl,{direction:e,key:o,onClick:"right"===e?t.moveToTheRight:t.moveToTheLeft})}):null},e.prototype.addCarouselItem=function(t){t&&this.carouselItems.length<this.props.images.length&&(this.carouselItems.push(t),this.registerEvents(t))},e.prototype.moveInDirection=function(t,e){void 0===e&&(e=!1);var r=this.state.activeIndex,o="right"===t?r+1:r-1;this.setState({activeIndex:o,alertMessage:"",animate:!0,position:e?this.state.position:0})},e.prototype.registerEvents=function(t){t.addEventListener("swipeleft",this.handleSwipe),t.addEventListener("swipeleftend",this.handleSwipeLeftEnd),t.addEventListener("swiperight",this.handleSwipe),t.addEventListener("swiperightend",this.handleSwipeRightEnd),t.addEventListener("touchmove",function(t){return t.preventDefault()})},e.prototype.removeEvents=function(){var t=this;this.carouselItems.forEach(function(e){e.removeEventListener("swipeleft",t.handleSwipe),e.removeEventListener("swipeleftend",t.handleSwipeLeftEnd),e.removeEventListener("swiperight",t.handleSwipe),e.removeEventListener("swiperightend",t.handleSwipeRightEnd),e.removeEventListener("touchmove",function(t){return t.preventDefault()})})},e.prototype.handleSwipe=function(t){var e=t.target.parentElement;this.carouselWidth=this.carouselWidth||(e?e.offsetWidth:0);var r=this.calculateSwipePercentage(t,this.carouselWidth);this.shouldSwipe(r)&&this.setState({activeIndex:this.state.activeIndex,animate:!1,position:r,showControls:!1})},e.prototype.handleSwipeEnd=function(t,e){var r=this.calculateSwipePercentage(t,this.carouselWidth);if(this.shouldSwipe(r)){this.carouselWidth=0;Math.abs(r)>20&&this.moveInDirection("right"===e?"left":"right",!0)}this.swipeStartPosition=0,this.setState({activeIndex:this.state.activeIndex,animate:!0,position:0,showControls:!!this.carouselItems.length})},e.prototype.calculateSwipePercentage=function(t,e){return this.swipeStartPosition||(this.swipeStartPosition=t.detail.pageX),100/e*(t.detail.pageX-this.swipeStartPosition)},e.prototype.shouldSwipe=function(t){return t>0?this.state.activeIndex>0:this.state.activeIndex<this.carouselItems.length-1},e.defaultProps={images:[]},e}(r.Component);e.Carousel=c}.apply(e,o))&&(t.exports=i)},function(t,e,r){var o,i;o=[r,e,r(0),r(1)],void 0!==(i=function(t,e,r,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CarouselControl=function(t){return r.createElement("div",{className:o("widget-carousel-control",t.direction),onClick:t.onClick},r.createElement("span",{className:o("glyphicon","glyphicon-chevron-"+t.direction)}))},e.CarouselControl.displayName="CarouselControl"}.apply(e,o))&&(t.exports=i)},function(t,e,r){var o,i;o=[r,e,r(0),r(1)],void 0!==(i=function(t,e,r,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CarouselItem=function(t){return r.createElement("div",{className:o("widget-carousel-item",t.status),onClick:t.onClick,ref:function(e){t.getItemNode&&t.getItemNode(e)},style:{transform:"translate3d("+t.position+"%, 0px, 0px)"}},r.createElement("img",{className:"widget-carousel-image",alt:"Carousel image",src:t.url}))},e.CarouselItem.defaultProps={position:0},e.CarouselItem.displayName="CarouselItem"}.apply(e,o))&&(t.exports=i)},function(t,e){},function(t,e,r){var o,i;o=[r,e],void 0!==(i=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.getStaticResourceUrlFromPath=function(t){return this.startsWith(t,"data:")?t:mx.appUrl+t},t.getStaticResourceUrl=function(t){if(this.startsWith(t,"data:"))return t;/^\w+:\/\//.test(t)||(t=this.getStaticResourceUrlFromPath(t));var e=mx.server.getCacheBust();return this.startsWith(t,mx.appUrl)&&!this.endsWith(t,e)&&(t+=(/\?/.test(t)?"&":"?")+e),t},t.getDynamicResourcePath=function(t,e,r){var o="file?"+["guid="+t,"changedDate="+e].join("&");return r&&(o+="&thumb=true"),o},t.getDynamicResourceUrl=function(t,e,r){return void 0===r&&(r=!1),mx.remoteUrl+this.getDynamicResourcePath(t,e,r)},t.startsWith=function(t,e){return 0===t.indexOf(e)},t.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)},t}();e.UrlHelper=r}.apply(e,o))&&(t.exports=i)}])});